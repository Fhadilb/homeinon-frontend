<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HomeInOn</title>
  <style>
    :root{
      --brand-accent:#F4A27B;
      --brand-bg:#FFF8F5;
      --ink:#2C2C2C;
      --muted:#6B6B6B;
      --card:#FFFFFF;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial, sans-serif;background:var(--brand-bg);color:var(--ink)}

    /* Sticky header with transparency + blur (desktop) */
    header{
      position:sticky; top:0; z-index:1000;
      background:rgba(255,255,255,0.85);
      backdrop-filter:saturate(1.2) blur(8px);
      -webkit-backdrop-filter:saturate(1.2) blur(8px);
      border-bottom:1px solid rgba(0,0,0,0.06);
    }
    .top-bar{
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 20px;
    }
    .logo img{height:60px; width:auto; object-fit:contain}
    button{
      background:var(--brand-accent); color:#fff; border:none; border-radius:8px;
      padding:8px 16px; font-weight:700; cursor:pointer; transition:.2s;
    }
    button:hover{background:#e18f6a}

    /* Style cards (ALWAYS visible in header on desktop) */
    .styles{
      display:flex; gap:12px; overflow-x:auto; padding:10px 20px;
    }
    .style-card{
      min-width:130px; height:110px; border-radius:10px; overflow:hidden;
      position:relative; cursor:pointer; border:2px solid transparent; flex:0 0 auto;
      transition:transform .2s, border .2s;
    }
    .style-card img{width:100%; height:100%; object-fit:cover}
    .style-card span{
      position:absolute; bottom:5px; left:0; right:0;
      text-align:center; color:#fff; font-weight:700;
      text-shadow:0 0 4px rgba(0,0,0,0.8); background:rgba(0,0,0,0.25);
    }
    .style-card.active{border:2px solid var(--brand-accent); transform:scale(1.05)}

    /* Mobile filter toggle */
    #filterToggle{
      display:none; width:100%; background:var(--brand-accent); color:#fff;
      border:none; padding:10px; cursor:pointer; font-weight:700;
    }

    /* Filters */
    .filters{
      display:grid; grid-template-columns:repeat(5,minmax(160px,1fr)); gap:16px;
      padding:10px 20px;
    }
    .filter-group{display:flex; flex-direction:column; gap:6px}
    .filter-group label{font-size:.9rem; color:var(--muted)}
    .filter-group input,
    .filter-group select,
    .filter-group input[type="range"]{
      padding:8px; border-radius:8px; border:1px solid #ddd; font-size:1rem; background:#fff;
    }

    /* Custom colour dropdown (name + swatch) */
    .colour-dropdown{position:relative}
    .colour-select{
      padding:8px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer;
    }
    .colour-list{
      display:none; position:absolute; top:110%; left:0; right:0; background:#fff;
      border:1px solid #ccc; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.1);
      max-height:220px; overflow-y:auto; z-index:10;
    }
    .colour-list.active{display:block}
    .colour-item{display:flex; align-items:center; gap:8px; padding:8px 10px; cursor:pointer}
    .colour-item:hover{background:#f8f8f8}
    .swatch{width:16px; height:16px; border-radius:50%; border:1px solid #ccc}

    /* Products */
    #product-count{margin:15px 20px 10px; font-weight:700}
    #product-list{
      display:grid; gap:24px; padding:0 20px 30px;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    }
    .product{
      background:#fff; border-radius:12px; box-shadow:0 1px 8px rgba(0,0,0,.08);
      overflow:hidden; position:relative; transition:transform .2s;
    }
    .product:hover{transform:translateY(-4px)}
    .product img{width:100%; height:320px; object-fit:cover}
    .style-label{
      position:absolute; top:10px; right:10px; background:var(--brand-accent); color:#fff;
      padding:4px 8px; border-radius:6px; font-size:.8rem; font-weight:700;
    }
    .product-info{padding:14px}
    .price{font-weight:700; color:var(--brand-accent)}

    /* Mobile: header not sticky, filters collapsible */
    @media (max-width:768px){
      header{position:static; backdrop-filter:none; -webkit-backdrop-filter:none; background:var(--card)}
      .filters{display:none; grid-template-columns:1fr}
      .filters.active{display:grid}
      #filterToggle{display:block}
      .styles{padding:10px 20px}
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="logo"><img src="Home-in-on-logo.webp" alt="HomeInOn Logo"></div>
      <button id="toggleFavourites">⭐ View Favourites</button>
    </div>

    <!-- STYLE CARDS (restored) -->
    <div class="styles" id="styleSelector"></div>

    <button id="filterToggle">Show Filters ⬇️</button>

    <section class="filters" id="filters">
      <div class="filter-group">
        <label for="searchBox">Search</label>
        <input type="text" id="searchBox" placeholder="e.g. oak table, mirror, sofa…"/>
      </div>

      <div class="filter-group">
        <label for="category">Category</label>
        <select id="category"><option value="">All</option></select>
      </div>

      <div class="filter-group">
        <label for="material">Material</label>
        <select id="material"><option value="">All</option></select>
      </div>

      <div class="filter-group colour-dropdown">
        <label for="colourSelect">Colour</label>
        <div id="colourSelect" class="colour-select">All</div>
        <div id="colourList" class="colour-list"></div>
      </div>

      <div class="filter-group">
        <label for="priceRange">Max Price (£)</label>
        <input type="range" id="priceRange" min="0" max="2000" step="10" value="2000"/>
        <span id="priceValue">£2000</span>
      </div>
    </section>
  </header>

  <p id="product-count"></p>
  <div id="product-list"></div>

  <script>
    const API_URL = "https://homeinon-backend.onrender.com/products";

    /* Style card images (extend as you add files) */
    const STYLE_IMAGES = {
      "modern":"style-modern.jpg",
      "boho":"style-boho.jpg",
      "scandi":"style-scandi.jpg",
      "industrial":"style-industrial.jpg",
      "farmhouse":"https://placehold.co/200x150?text=Farmhouse",
      "mid-century":"https://placehold.co/200x150?text=Mid-century",
      "art deco":"https://placehold.co/200x150?text=Art+Deco",
      "coastal":"https://placehold.co/200x150?text=Coastal"
    };

    /* Colour map (expanded) */
    const colourMap = {
      white:"#ffffff", black:"#000000", grey:"#9e9e9e", gray:"#9e9e9e",
      oak:"#c49a6c", walnut:"#7a5734", pine:"#d5b887", beige:"#d9c7a2",
      gold:"#c8a951", silver:"#bdbdbd", blue:"#5a7abf", green:"#6aa67a",
      red:"#c74c4c", brown:"#8b5a2b", cream:"#f3e9d2", yellow:"#f8e473",
      ivory:"#fffff0", natural:"#d6b98c", charcoal:"#36454f", teal:"#367588",
      taupe:"#b38b6d", stone:"#c2b59b", pink:"#f7c6d9", orange:"#f6a04d",
      navy:"#001f3f", mink:"#b7a295", copper:"#b87333", bronze:"#cd7f32",
      lilac:"#c8a2c8", sage:"#a9bfa5", mustard:"#e1ad01", terracotta:"#e2725b",
      pewter:"#8e9292"
    };
    const colourHex = n => colourMap[String(n||"").toLowerCase()] || "#ccc";

    /* Simple deriveStyle if backend missing style */
    function deriveStyle(txt=""){
      const t = String(txt).toLowerCase();
      if(t.includes("boho")) return "Boho";
      if(t.includes("industrial")||t.includes("metal")) return "Industrial";
      if(t.includes("scandi")||t.includes("nordic")) return "Scandi";
      if(t.includes("farmhouse")||t.includes("rustic")) return "Farmhouse";
      if(t.includes("mid")||t.includes("retro")) return "Mid-century";
      if(t.includes("art deco")||t.includes("glam")) return "Art Deco";
      if(t.includes("coastal")||t.includes("beach")) return "Coastal";
      return "Modern";
    }

    let allProducts = [];
    let selectedStyle = "";
    let selectedColour = "";

    const uniqueValues = (arr, field)=>{
      const s = new Set();
      arr.forEach(p=>{
        const v = p[field]; if(!v) return;
        String(v).split(/[,/|;]/).forEach(x=>{
          const val = x.trim(); if(val) s.add(val);
        });
      });
      return [...s];
    };

    function buildStyleCards(styles){
      const row = document.getElementById("styleSelector");
      row.innerHTML = "";
      styles.forEach(style=>{
        const card = document.createElement("div");
        card.className = "style-card";
        const imgSrc = STYLE_IMAGES[style.toLowerCase()] || `https://placehold.co/200x150?text=${encodeURIComponent(style)}`;
        card.innerHTML = `<img src="${imgSrc}" alt="${style}"><span>${style}</span>`;
        card.addEventListener("click", ()=>{
          document.querySelectorAll(".style-card").forEach(c=>c.classList.remove("active"));
          if(selectedStyle === style){ selectedStyle = ""; }
          else { selectedStyle = style; card.classList.add("active"); }
          applyFilters();
        });
        row.appendChild(card);
      });
    }

    /* Colour dropdown with swatch + name */
    function buildColourDropdown(colours){
      const select = document.getElementById("colourSelect");
      const list = document.getElementById("colourList");
      list.innerHTML = "";

      const allItem = document.createElement("div");
      allItem.className = "colour-item";
      allItem.textContent = "All";
      allItem.addEventListener("click", ()=>{
        selectedColour = ""; select.textContent = "All"; list.classList.remove("active"); applyFilters();
      });
      list.appendChild(allItem);

      colours.forEach(c=>{
        const item = document.createElement("div");
        item.className = "colour-item";
        item.innerHTML = `<span class="swatch" style="background:${colourHex(c)}"></span>${c}`;
        item.addEventListener("click", ()=>{
          selectedColour = c;
          select.innerHTML = `<span class="swatch" style="background:${colourHex(c)}"></span>${c}`;
          list.classList.remove("active");
          applyFilters();
        });
        list.appendChild(item);
      });

      select.addEventListener("click", ()=> list.classList.toggle("active"));
      document.addEventListener("click", e=>{
        if(!e.target.closest(".colour-dropdown")) list.classList.remove("active");
      });
    }

    function renderProducts(products){
      const list = document.getElementById("product-list");
      const count = document.getElementById("product-count");
      list.innerHTML = "";
      count.textContent = `${products.length} product${products.length!==1?"s":""} found`;
      products.forEach(p=>{
        const price = parseFloat(p.price) || 0;
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          <div class="style-label">${p.style || ""}</div>
          <img src="${p.image_url}" alt="${p.title}" onerror="this.src='https://placehold.co/340x240?text=No+Image'"/>
          <div class="product-info">
            <h3>${p.title}</h3>
            <p class="price">£${price.toFixed(2)}</p>
          </div>
        `;
        list.appendChild(div);
      });
    }

    function applyFilters(){
      const q = document.getElementById("searchBox").value.toLowerCase();
      const cat = document.getElementById("category").value;
      const mat = document.getElementById("material").value;
      const max = parseFloat(document.getElementById("priceRange").value) || Infinity;

      const filtered = allProducts.filter(p=>{
        const t = (p.title||"").toLowerCase();
        const d = (p.description||"").toLowerCase();
        const search = !q || t.includes(q) || d.includes(q);
        const catOK = !cat || p.category === cat;
        const matOK = !mat || p.material === mat;
        const styleOK = !selectedStyle || p.style === selectedStyle;
        const colourOK = !selectedColour || (p.colour && p.colour.toLowerCase().includes(selectedColour.toLowerCase()));
        const pr = parseFloat(p.price) || 0;
        const priceOK = pr <= max;
        return search && catOK && matOK && styleOK && colourOK && priceOK;
      });

      renderProducts(filtered);
    }

    async function loadProducts(){
      const res = await fetch(API_URL);
      const data = await res.json();
      allProducts = (data.products || []).map(p=>({
        ...p,
        style: p.style || deriveStyle(p.title || p.description)
      }));

      // Build controls from live data
      const styles = uniqueValues(allProducts, "style");
      const cats   = uniqueValues(allProducts, "category");
      const mats   = uniqueValues(allProducts, "material");
      const cols   = uniqueValues(allProducts, "colour");

      // Populate selects
      const catSel = document.getElementById("category");
      const matSel = document.getElementById("material");
      catSel.innerHTML = '<option value="">All</option>' + cats.sort().map(c=>`<option value="${c}">${c}</option>`).join("");
      matSel.innerHTML = '<option value="">All</option>' + mats.sort().map(m=>`<option value="${m}">${m}</option>`).join("");

      buildColourDropdown(cols.sort());
      buildStyleCards(styles.sort());

      // Price slider max from data
      const maxP = Math.ceil(Math.max(0, ...allProducts.map(p=>parseFloat(p.price)||0))/50)*50 || 2000;
      const pr = document.getElementById("priceRange");
      pr.max = maxP; pr.value = maxP;
      document.getElementById("priceValue").textContent = `£${maxP}`;

      renderProducts(allProducts);
    }

    // Events
    document.getElementById("filterToggle").addEventListener("click", ()=>{
      const f = document.getElementById("filters");
      f.classList.toggle("active");
      document.getElementById("filterToggle").textContent = f.classList.contains("active") ? "Hide Filters ▲" : "Show Filters ⬇️";
    });
    document.getElementById("searchBox").addEventListener("input", applyFilters);
    document.getElementById("category").addEventListener("change", applyFilters);
    document.getElementById("material").addEventListener("change", applyFilters);
    document.getElementById("priceRange").addEventListener("input", e=>{
      document.getElementById("priceValue").textContent = `£${e.target.value}`;
      applyFilters();
    });

    loadProducts();
  </script>
</body>
</html>






