<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HomeInOn</title>
  <style>
    :root{
      --brand-accent:#F4A27B;
      --brand-bg:#FFF8F5;
      --ink:#2C2C2C;
      --muted:#6B6B6B;
      --card:#FFFFFF;
      --input-border:#dddddd;
      --caret:#666666;
      --caret-svg:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 6'><path fill='%23666' d='M1 0l4 4 4-4 1 1-5 5-5-5z'/></svg>");
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial, sans-serif;background:var(--brand-bg);color:var(--ink)}

    header{
      position:sticky; top:0; z-index:1000;
      background:rgba(255,255,255,0.85);
      backdrop-filter:saturate(1.2) blur(8px);
      -webkit-backdrop-filter:saturate(1.2) blur(8px);
      border-bottom:1px solid rgba(0,0,0,0.06);
    }
    .top-bar{display:flex; justify-content:space-between; align-items:center; padding:10px 20px;}
    .logo img{height:60px; width:auto; object-fit:contain}
    button{background:var(--brand-accent); color:#fff; border:none; border-radius:8px; padding:8px 16px; font-weight:700; cursor:pointer; transition:.2s;}
    button:hover{background:#e18f6a}

    .styles{ display:flex; gap:12px; overflow-x:auto; padding:10px 20px; }
    .style-card{ min-width:130px; height:110px; border-radius:10px; overflow:hidden; position:relative; cursor:pointer; border:2px solid transparent; flex:0 0 auto; transition:transform .2s, border .2s; }
    .style-card img{width:100%; height:100%; object-fit:cover}
    .style-card span{ position:absolute; bottom:5px; left:0; right:0; text-align:center; color:#fff; font-weight:700; text-shadow:0 0 4px rgba(0,0,0,0.8); background:rgba(0,0,0,0.25); }
    .style-card.active{border:2px solid var(--brand-accent); transform:scale(1.05)}

    #filterToggle{ display:none; width:100%; background:var(--brand-accent); color:#fff; border:none; padding:10px; cursor:pointer; font-weight:700; }

    .filters{ display:grid; grid-template-columns:repeat(5,minmax(160px,1fr)); gap:16px; padding:10px 20px; }
    .filter-group{display:flex; flex-direction:column; gap:6px}
    .filter-group label{font-size:.9rem; color:var(--muted)}

    .filter-group select,
    .filter-group input[type="text"],
    .filter-group input[type="range"]{
      height:38px; font-size:1rem;
    }

    .filter-group select{
      padding:0 36px 0 12px;
      border-radius:8px; border:1px solid var(--input-border); background:#fff;
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      background-image:var(--caret-svg);
      background-repeat:no-repeat;
      background-position:right 12px center;
      background-size:12px 8px;
      color:var(--ink);
    }

    .colour-dropdown{position:relative}
    .colour-select{
      height:38px; display:flex; align-items:center;
      padding:0 36px 0 12px; border-radius:8px; border:1px solid var(--input-border);
      background:#fff; cursor:pointer; font-size:1rem; color:var(--ink);
      position:relative;
      background-image:var(--caret-svg);
      background-repeat:no-repeat;
      background-position:right 12px center;
      background-size:12px 8px;
    }
    .colour-list{
      display:none; position:absolute; top:110%; left:0; right:0; background:#fff;
      border:1px solid #ccc; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.1);
      max-height:220px; overflow-y:auto; z-index:10;
    }
    .colour-list.active{display:block}
    .colour-item{display:flex; align-items:center; gap:8px; padding:8px 10px; cursor:pointer}
    .colour-item:hover{background:#f8f8f8}
    .swatch{width:16px; height:16px; border-radius:50%; border:1px solid #ccc}

    #product-count{margin:15px 20px 10px; font-weight:700}
    #product-list{ display:grid; gap:24px; padding:0 20px 30px; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); }
    .product{ background:#fff; border-radius:12px; box-shadow:0 1px 8px rgba(0,0,0,.08); overflow:hidden; position:relative; transition:transform .2s; cursor:pointer; }
    .product:hover{transform:translateY(-4px)}
    .product img{width:100%; height:320px; object-fit:cover}
    .style-label{ position:absolute; top:10px; right:10px; background:var(--brand-accent); color:#fff; padding:4px 8px; border-radius:6px; font-size:.8rem; font-weight:700; }
    .product-info{padding:14px}
    .price{font-weight:700; color:var(--brand-accent)}

    .modal-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:2000; }
    .modal{
      width:min(1100px, 96vw);
      max-height:90vh; overflow:auto;
      background:#fff; border-radius:14px; box-shadow:0 20px 60px rgba(0,0,0,.25);
      display:grid; grid-template-columns: 1.35fr 1fr; gap:0; position:relative;
    }
    .modal .modal-img{ background:#f3f3f3; min-height:360px; }
    .modal .modal-img img{ width:100%; height:100%; object-fit:cover; border-top-left-radius:14px; border-bottom-left-radius:14px; }
    .modal .modal-body{ padding:24px 24px 22px; }
    .modal h2{ margin-bottom:8px; padding-right:48px; }
    .modal .price-lg{font-size:1.3rem; font-weight:800; color:var(--brand-accent); margin-bottom:10px}
    .meta{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:10px 0 14px}
    .meta div{background:#fafafa; border:1px solid #eee; border-radius:8px; padding:10px; font-size:.95rem}
    .desc{color:#444; line-height:1.5; margin:6px 0 14px}
    .modal-actions{display:flex; gap:10px; margin-top:8px; flex-wrap:wrap}
    .btn-primary{ background:var(--brand-accent); color:#fff; border:none; border-radius:8px; padding:10px 16px; font-weight:700; cursor:pointer; }
    .close-x{
      position:absolute; top:10px; right:10px;
      background:rgba(255,255,255,0.95); color:#000;
      border:1px solid #ccc; border-radius:8px; padding:6px 10px;
      cursor:pointer; font-weight:800; z-index:1;
    }

    @media (max-width:768px){
      header{position:static; backdrop-filter:none; -webkit-backdrop-filter:none; background:var(--card)}
      .filters{display:none; grid-template-columns:1fr}
      .filters.active{display:grid}
      #filterToggle{display:block}
      .styles{padding:10px 20px}
      .modal{grid-template-columns:1fr}
      .modal .modal-img img{border-radius:14px 14px 0 0}
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="logo"><img src="Home-in-on-logo.webp" alt="HomeInOn Logo"></div>
      <button id="toggleFavourites">⭐ View Favourites</button>
    </div>

    <div class="styles" id="styleSelector"></div>

    <button id="filterToggle">Show Filters ⬇️</button>

    <section class="filters" id="filters">
      <div class="filter-group">
        <label for="searchBox">Search</label>
        <input type="text" id="searchBox" placeholder="e.g. oak table, mirror, sofa…"/>
      </div>

      <div class="filter-group">
        <label for="category">Category</label>
        <select id="category"><option value="">All</option></select>
      </div>

      <div class="filter-group">
        <label for="material">Material</label>
        <select id="material"><option value="">All</option></select>
      </div>

      <div class="filter-group colour-dropdown">
        <label for="colourSelect">Colour</label>
        <div id="colourSelect" class="colour-select">All</div>
        <div id="colourList" class="colour-list"></div>
      </div>

      <div class="filter-group">
        <label for="priceRange">Max Price (£)</label>
        <input type="range" id="priceRange" min="0" max="2000" step="10" value="2000"/>
        <span id="priceValue">£2000</span>
      </div>
    </section>
  </header>

  <p id="product-count"></p>
  <div id="product-list"></div>

  <div id="productModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close-x" id="modalClose" aria-label="Close">✕</button>
      <div class="modal-img"><img id="modalImage" alt="Product image"/></div>
      <div class="modal-body">
        <h2 id="modalTitle">Title</h2>
        <div class="price-lg" id="modalPrice">£0.00</div>
        <div class="meta">
          <div><strong>Category:</strong> <span id="modalCategory">—</span></div>
          <div><strong>Material:</strong> <span id="modalMaterial">—</span></div>
          <div><strong>Colour:</strong> <span id="modalColour">—</span></div>
          <div><strong>Style:</strong> <span id="modalStyle">—</span></div>
        </div>
        <div class="desc" id="modalDescription">Description here…</div>
        <div class="modal-actions">
          <a id="modalLink" class="btn-primary" href="#" target="_blank" rel="noopener" style="display:none">View product</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://homeinon-backend.onrender.com/products";

    const STYLE_IMAGES = {
      "modern":"style-modern.jpg",
      "boho":"style-boho.jpg",
      "scandi":"style-scandi.jpg",
      "industrial":"style-industrial.jpg",
      "farmhouse":"https://placehold.co/200x150?text=Farmhouse",
      "mid-century":"https://placehold.co/200x150?text=Mid-century",
      "art deco":"https://placehold.co/200x150?text=Art+Deco",
      "coastal":"https://placehold.co/200x150?text=Coastal"
    };

    const colourMap = {
      white:"#ffffff", black:"#000000", grey:"#9e9e9e", gray:"#9e9e9e",
      oak:"#c49a6c", walnut:"#7a5734", pine:"#d5b887", beige:"#d9c7a2",
      gold:"#c8a951", silver:"#bdbdbd", blue:"#5a7abf", green:"#6aa67a",
      red:"#c74c4c", brown:"#8b5a2b", cream:"#f3e9d2", yellow:"#f8e473",
      ivory:"#fffff0", natural:"#d6b98c", charcoal:"#36454f", teal:"#367588",
      taupe:"#b38b6d", stone:"#c2b59b", pink:"#f7c6d9", orange:"#f6a04d",
      navy:"#001f3f", mink:"#b7a295", copper:"#b87333", bronze:"#cd7f32",
      lilac:"#c8a2c8", sage:"#a9bfa5", mustard:"#e1ad01", terracotta:"#e2725b",
      pewter:"#8e9292"
    };
    const colourHex = n => colourMap[String(n||"").toLowerCase()] || "#ccc";

    function deriveStyle(txt=""){
      const t = String(txt).toLowerCase();
      if(t.includes("boho")) return "Boho";
      if(t.includes("industrial")||t.includes("metal")) return "Industrial";
      if(t.includes("scandi")||t.includes("nordic")) return "Scandi";
      if(t.includes("farmhouse")||t.includes("rustic")) return "Farmhouse";
      if(t.includes("mid")||t.includes("retro")) return "Mid-century";
      if(t.includes("art deco")||t.includes("glam")) return "Art Deco";
      if(t.includes("coastal")||t.includes("beach")) return "Coastal";
      return "Modern";
    }

    let allProducts = [];
    let selectedStyle = "";
    let selectedColour = "";

    /* ---------- helper: get current state ---------- */
    function getState(){
      return {
        q: document.getElementById("searchBox").value.toLowerCase(),
        category: document.getElementById("category").value,
        material: document.getElementById("material").value,
        colour: selectedColour,
        style: selectedStyle,
        max: parseFloat(document.getElementById("priceRange").value) || Infinity
      };
    }

    /* ---------- filter with optional field to ignore (for repopulating options) ---------- */
    function filterProducts(state, ignoreField){
      return allProducts.filter(p=>{
        const t = (p.title||"").toLowerCase();
        const d = (p.description||"").toLowerCase();
        const price = parseFloat(p.price)||0;

        const checks = {
          q: (!state.q) || t.includes(state.q) || d.includes(state.q),
          category: (!state.category) || p.category === state.category,
          material: (!state.material) || p.material === state.material,
          colour: (!state.colour) || (p.colour && p.colour.toLowerCase().includes(state.colour.toLowerCase())),
          style: (!state.style) || p.style === state.style,
          max: price <= state.max
        };

        if(ignoreField){ checks[ignoreField] = true; }
        return checks.q && checks.category && checks.material && checks.colour && checks.style && checks.max;
      });
    }

    /* ---------- uniques ---------- */
    const uniqueValues = (arr, field)=>{
      const s = new Set();
      arr.forEach(p=>{
        const v = p[field]; if(!v) return;
        String(v).split(/[,/|;]/).forEach(x=>{
          const val = x.trim(); if(val) s.add(val);
        });
      });
      return [...s];
    };

    /* ---------- build UI data lists ---------- */
    function buildStyleCards(styles){
      const row = document.getElementById("styleSelector");
      row.innerHTML = "";
      styles.forEach(style=>{
        const card = document.createElement("div");
        card.className = "style-card";
        const imgSrc = STYLE_IMAGES[style.toLowerCase()] || `https://placehold.co/200x150?text=${encodeURIComponent(style)}`;
        card.innerHTML = `<img src="${imgSrc}" alt="${style}"><span>${style}</span>`;
        card.addEventListener("click", ()=>{
          document.querySelectorAll(".style-card").forEach(c=>c.classList.remove("active"));
          if(selectedStyle === style){ selectedStyle = ""; }
          else { selectedStyle = style; card.classList.add("active"); }
          updateFilterOptions();   // <-- dependent update
          applyFilters();
        });
        row.appendChild(card);
      });
    }

    function buildColourDropdown(colours, keepSelection=true){
      const select = document.getElementById("colourSelect");
      const list = document.getElementById("colourList");
      const prev = keepSelection ? selectedColour : "";

      list.innerHTML = "";

      const allItem = document.createElement("div");
      allItem.className = "colour-item";
      allItem.textContent = "All";
      allItem.addEventListener("click", ()=>{
        selectedColour = ""; select.textContent = "All"; list.classList.remove("active"); applyFilters();
      });
      list.appendChild(allItem);

      colours.forEach(c=>{
        const item = document.createElement("div");
        item.className = "colour-item";
        item.innerHTML = `<span class="swatch" style="background:${colourHex(c)}"></span>${c}`;
        item.addEventListener("click", ()=>{
          selectedColour = c;
          select.innerHTML = `<span class="swatch" style="background:${colourHex(c)}"></span>${c}`;
          list.classList.remove("active");
          updateFilterOptions();   // <-- dependent update
          applyFilters();
        });
        list.appendChild(item);
      });

      // Restore label
      if(prev){
        selectedColour = colours.includes(prev) ? prev : "";
        if(selectedColour){
          select.innerHTML = `<span class="swatch" style="background:${colourHex(selectedColour)}"></span>${selectedColour}`;
        }else{
          select.textContent = "All";
        }
      }else{
        select.textContent = "All";
      }

      select.onclick = ()=> list.classList.toggle("active");
      document.addEventListener("click", e=>{
        if(!e.target.closest(".colour-dropdown")) list.classList.remove("active");
      });
    }

    function renderProducts(products){
      const list = document.getElementById("product-list");
      const count = document.getElementById("product-count");
      list.innerHTML = "";
      count.textContent = `${products.length} product${products.length!==1?"s":""} found`;
      products.forEach((p, idx)=>{
        const price = parseFloat(p.price) || 0;
        const div = document.createElement("div");
        div.className = "product";
        div.setAttribute("data-index", idx);
        div.innerHTML = `
          <div class="style-label">${p.style || ""}</div>
          <img src="${p.image_url}" alt="${p.title}" onerror="this.src='https://placehold.co/340x240?text=No+Image'"/>
          <div class="product-info">
            <h3>${p.title}</h3>
            <p class="price">£${price.toFixed(2)}</p>
          </div>
        `;
        div.addEventListener("click", ()=> openProductModal(idx));
        list.appendChild(div);
      });
    }

    function applyFilters(){
      const filtered = filterProducts(getState());
      renderProducts(filtered);
    }

    /* ---------- DEPENDENT FILTERS ---------- */
    function updateFilterOptions(){
      const state = getState();

      // Recompute options for each control based on other filters
      // Category options (ignore 'category' while filtering)
      const catList = uniqueValues(filterProducts(state, 'category'), 'category').sort();
      const catSel = document.getElementById("category");
      const currentCat = state.category;
      catSel.innerHTML = '<option value="">All</option>' + catList.map(c=>`<option value="${c}">${c}</option>`).join("");
      if(currentCat && catList.includes(currentCat)) catSel.value = currentCat; else catSel.value = "";

      // Material options
      const matList = uniqueValues(filterProducts(state, 'material'), 'material').sort();
      const matSel = document.getElementById("material");
      const currentMat = state.material;
      matSel.innerHTML = '<option value="">All</option>' + matList.map(m=>`<option value="${m}">${m}</option>`).join("");
      if(currentMat && matList.includes(currentMat)) matSel.value = currentMat; else matSel.value = "";

      // Colour options (rebuild custom dropdown)
      const colourList = uniqueValues(filterProducts(state, 'colour'), 'colour').sort();
      buildColourDropdown(colourList, /*keepSelection*/ true);
    }

    /* ---------- Modal ---------- */
    const modalOverlay = document.getElementById("productModal");
    const modalImage   = document.getElementById("modalImage");
    const modalTitle   = document.getElementById("modalTitle");
    const modalPrice   = document.getElementById("modalPrice");
    const modalCat     = document.getElementById("modalCategory");
    const modalMat     = document.getElementById("modalMaterial");
    const modalCol     = document.getElementById("modalColour");
    const modalStyle   = document.getElementById("modalStyle");
    const modalDesc    = document.getElementById("modalDescription");
    const modalLink    = document.getElementById("modalLink");
    const modalClose   = document.getElementById("modalClose");

    function openProductModal(index){
      const filtered = filterProducts(getState());
      const p = filtered[index];
      if(!p) return;

      modalImage.src = p.image_url || "https://placehold.co/640x480?text=No+Image";
      modalImage.onerror = () => modalImage.src = "https://placehold.co/640x480?text=No+Image";
      modalTitle.textContent = p.title || "Untitled";
      modalPrice.textContent = `£${(parseFloat(p.price)||0).toFixed(2)}`;
      modalCat.textContent = p.category || "—";
      modalMat.textContent = p.material || "—";
      modalCol.textContent = p.colour || "—";
      modalStyle.textContent = p.style || deriveStyle(p.title || p.description);
      modalDesc.textContent = p.description || "—";

      if(p.url){ modalLink.style.display="inline-block"; modalLink.href=p.url; }
      else { modalLink.style.display="none"; modalLink.removeAttribute("href"); }

      modalOverlay.style.display = "flex";
      modalOverlay.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeProductModal(){
      modalOverlay.style.display = "none";
      modalOverlay.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }
    modalClose.addEventListener("click", closeProductModal);
    modalOverlay.addEventListener("click", (e)=>{ if(e.target === modalOverlay) closeProductModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeProductModal(); });

    /* ---------- Load & boot ---------- */
    async function loadProducts(){
      const res = await fetch(API_URL);
      const data = await res.json();
      allProducts = (data.products || []).map(p=>({
        ...p,
        style: p.style || deriveStyle(p.title || p.description)
      }));

      // Initial population (all options)
      const styles = uniqueValues(allProducts, "style").sort();
      const cats   = uniqueValues(allProducts, "category").sort();
      const mats   = uniqueValues(allProducts, "material").sort();
      const cols   = uniqueValues(allProducts, "colour").sort();

      // Style cards
      buildStyleCards(styles);

      // Category & material
      const catSel = document.getElementById("category");
      const matSel = document.getElementById("material");
      catSel.innerHTML = '<option value="">All</option>' + cats.map(c=>`<option value="${c}">${c}</option>`).join("");
      matSel.innerHTML = '<option value="">All</option>' + mats.map(m=>`<option value="${m}">${m}</option>`).join("");

      // Colour dropdown
      buildColourDropdown(cols, true);

      // Price range
      const maxP = Math.ceil(Math.max(0, ...allProducts.map(p=>parseFloat(p.price)||0))/50)*50 || 2000;
      const pr = document.getElementById("priceRange");
      pr.max = maxP; pr.value = maxP;
      document.getElementById("priceValue").textContent = `£${maxP}`;

      renderProducts(allProducts);
    }

    // Mobile toggle
    document.getElementById("filterToggle").addEventListener("click", ()=>{
      const f = document.getElementById("filters");
      f.classList.toggle("active");
      document.getElementById("filterToggle").textContent = f.classList.contains("active") ? "Hide Filters ▲" : "Show Filters ⬇️";
    });

    // Events: also call updateFilterOptions so lists stay in sync
    document.getElementById("searchBox").addEventListener("input", ()=>{ updateFilterOptions(); applyFilters(); });
    document.getElementById("category").addEventListener("change", ()=>{ updateFilterOptions(); applyFilters(); });
    document.getElementById("material").addEventListener("change", ()=>{ updateFilterOptions(); applyFilters(); });
    document.getElementById("priceRange").addEventListener("input", e=>{
      document.getElementById("priceValue").textContent = `£${e.target.value}`;
      updateFilterOptions(); applyFilters();
    });

    loadProducts();
  </script>
</body>
</html>






