<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HomeInOn</title>
  <style>
    :root{
      --brand-accent:#F4A27B;
      --brand-bg:#FFF8F5;
      --ink:#2C2C2C;
      --muted:#6B6B6B;
      --card:#FFFFFF;
      --input-border:#dddddd;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.15);
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      --caret-svg:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 10 6'><path fill='%23666' d='M1 0l4 4 4-4 1 1-5 5-5-5z'/></svg>");
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background:var(--brand-bg);
      color:var(--ink);
      line-height: 1.6;
    }

    /* ===== HEADER ===== */
    header{
      position:sticky; 
      top:0; 
      z-index:1000;
      background:rgba(255,255,255,0.95);
      backdrop-filter:saturate(1.2) blur(12px);
      -webkit-backdrop-filter:saturate(1.2) blur(12px);
      border-bottom:1px solid rgba(0,0,0,0.08);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .top-bar{
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      padding: 16px 24px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .logo img{
      height:60px; 
      width:auto; 
      object-fit:contain;
      transition: transform 0.2s;
    }
    .logo img:hover{ transform: scale(1.02); }

    /* ===== BUTTONS ===== */
    button{
      background:var(--brand-accent); 
      color:#fff; 
      border:none; 
      border-radius:10px; 
      padding: 10px 20px; 
      font-weight:600; 
      font-size: 0.95rem;
      cursor:pointer; 
      transition: var(--transition);
      box-shadow: 0 2px 6px rgba(244, 162, 123, 0.3);
    }
    button:hover{
      background:#e18f6a;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(244, 162, 123, 0.4);
    }
    button:active{ transform: translateY(0); }

    .btn-outline{
      background:#fff; 
      color:var(--ink); 
      border:2px solid var(--input-border);
      box-shadow: none;
    }
    .btn-outline:hover{
      background: var(--brand-bg);
      border-color: var(--brand-accent);
      color: var(--brand-accent);
    }

    /* ===== STYLE SELECTOR ===== */
    .styles{ 
      display:flex; 
      gap:16px; 
      overflow-x:auto; 
      padding: 16px 24px; 
      scrollbar-width: thin;
      scrollbar-color: var(--brand-accent) transparent;
      /* Fade effect to show more cards */
      mask-image: linear-gradient(to right, black 90%, transparent 100%);
      -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
    }
    .styles::-webkit-scrollbar { height: 6px; }
    .styles::-webkit-scrollbar-track { background: transparent; }
    .styles::-webkit-scrollbar-thumb { 
      background: var(--brand-accent); 
      border-radius: 10px; 
    }

    .style-card{ 
      min-width:140px; 
      height:120px; 
      border-radius:12px; 
      overflow:hidden; 
      position:relative; 
      cursor:pointer; 
      border:3px solid transparent; 
      flex:0 0 auto; 
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }
    .style-card:hover{
      transform: translateY(-4px) scale(1.02);
      box-shadow: var(--shadow-md);
    }
    .style-card img{
      width:100%; 
      height:100%; 
      object-fit:cover;
      transition: transform 0.3s;
    }
    .style-card:hover img{ transform: scale(1.08); }

    .style-card span{ 
      position:absolute; 
      bottom:0; 
      left:0; 
      right:0; 
      text-align:center; 
      color:#fff; 
      font-weight:700; 
      font-size: 0.9rem;
      text-shadow:0 1px 4px rgba(0,0,0,0.8); 
      background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
      padding: 12px 8px 8px;
    }
    .style-card.active{
      border:3px solid var(--brand-accent); 
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(244, 162, 123, 0.5);
    }

    /* ===== FILTER TOGGLE (Mobile) ===== */
    #filterToggle{ 
      display:none; 
      width:100%; 
      background:var(--brand-accent); 
      color:#fff; 
      border:none; 
      padding:14px; 
      cursor:pointer; 
      font-weight:700;
      font-size: 1rem;
    }

    /* ===== FILTERS ===== */
    .filters{ 
      display:grid; 
      grid-template-columns:repeat(6, minmax(160px,1fr)); 
      gap:20px; 
      padding: 20px 24px 24px; 
      align-items:end;
      max-width: 1600px;
      margin: 0 auto;
      background: rgba(255,255,255,0.5);
    }
    .filter-group{
      display:flex; 
      flex-direction:column; 
      gap:8px;
    }
    .filter-group label{
      font-size:0.85rem; 
      font-weight: 600;
      color:var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-group select,
    .filter-group input[type="text"],
    .filter-group input[type="range"]{
      height:42px; 
      font-size:0.95rem;
      font-family: inherit;
    }

    .filter-group select,
    .filter-group input[type="text"]{
      padding: 0 40px 0 14px;
      border-radius:10px; 
      border:2px solid var(--input-border); 
      background:#fff;
      color:var(--ink);
      transition: var(--transition);
    }

    .filter-group select:focus,
    .filter-group input[type="text"]:focus{
      outline: none;
      border-color: var(--brand-accent);
      box-shadow: 0 0 0 3px rgba(244, 162, 123, 0.15);
    }

    .filter-group select{
      appearance:none; 
      -webkit-appearance:none; 
      -moz-appearance:none;
      background-image:var(--caret-svg);
      background-repeat:no-repeat;
      background-position:right 14px center;
      background-size:12px 8px;
      cursor: pointer;
    }

    /* ===== COLOUR DROPDOWN ===== */
    .colour-dropdown{position:relative}
    .colour-select{
      height:42px; 
      display:flex; 
      align-items:center;
      padding: 0 40px 0 14px; 
      border-radius:10px; 
      border:2px solid var(--input-border);
      background:#fff; 
      cursor:pointer; 
      font-size:0.95rem; 
      color:var(--ink);
      position:relative;
      background-image:var(--caret-svg);
      background-repeat:no-repeat;
      background-position:right 14px center;
      background-size:12px 8px;
      transition: var(--transition);
    }
    .colour-select:hover{
      border-color: var(--brand-accent);
    }
    .colour-list{
      display:none; 
      position:absolute; 
      top:calc(100% + 8px); 
      left:0; 
      right:0; 
      background:#fff;
      border:2px solid var(--input-border); 
      border-radius:10px; 
      box-shadow: var(--shadow-lg);
      max-height:260px; 
      overflow-y:auto; 
      z-index:100;
      animation: dropdownSlide 0.2s ease;
    }
    @keyframes dropdownSlide {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .colour-list.active{display:block}
    .colour-item{
      display:flex; 
      align-items:center; 
      gap:10px; 
      padding:12px 14px; 
      cursor:pointer;
      transition: background 0.15s;
    }
    .colour-item:hover{background:#f8f8f8}
    .colour-item:first-child{
      border-bottom: 1px solid #eee;
      font-weight: 600;
    }
    .swatch{
      width:20px; 
      height:20px; 
      border-radius:50%; 
      border:2px solid #ddd;
      flex-shrink: 0;
    }

    /* ===== PRODUCT LIST ===== */
    #product-count{
      margin: 24px 24px 16px; 
      font-weight:700;
      font-size: 1.1rem;
      color: var(--muted);
      max-width: 1600px;
      margin-left: auto;
      margin-right: auto;
      padding: 0 24px;
    }

    #product-list{ 
      display: grid; 
      gap: 28px; 
      padding: 0 24px 40px; 
      /* FIX: Use auto-fill with max width to prevent stretching */
      grid-template-columns: repeat(auto-fill, minmax(280px, 340px));
      justify-content: center;
      max-width: 1600px;
      margin: 0 auto;
    }

    .product{ 
      background:#fff; 
      border-radius:16px; 
      box-shadow: var(--shadow-sm);
      overflow:hidden; 
      position:relative; 
      transition: var(--transition);
      cursor:pointer;
      display: flex;
      flex-direction: column;
    }
    .product:hover{
      transform: translateY(-6px);
      box-shadow: var(--shadow-lg);
    }

    .product img{
      width:100%; 
      height:280px; 
      object-fit:cover;
      transition: transform 0.4s;
    }
    .product:hover img{
      transform: scale(1.05);
    }

    .style-label{ 
      position:absolute; 
      top:12px; 
      right:12px; 
      background: rgba(244, 162, 123, 0.95);
      backdrop-filter: blur(8px);
      color:#fff; 
      padding:6px 12px; 
      border-radius:8px; 
      font-size:0.8rem; 
      font-weight:700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .product-info{
      padding:18px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .product-info h3{
      font-size: 1.05rem;
      line-height: 1.4;
      color: var(--ink);
      font-weight: 600;
      /* Limit to 2 lines */
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .price{
      font-weight:800; 
      color:var(--brand-accent);
      font-size: 1.15rem;
      margin-top: auto;
    }

    /* ===== HEART BUTTONS ===== */
    .heart-btn{
      font-size:24px; 
      color:#ddd; 
      cursor:pointer; 
      transition: var(--transition);
      background:rgba(255,255,255,0.95); 
      backdrop-filter: blur(4px);
      border:none; 
      position:absolute; 
      bottom:14px; 
      right:14px;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .heart-btn:hover{
      transform:scale(1.2);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .heart-btn.liked{
      color:#e63946;
      background: rgba(230, 57, 70, 0.1);
    }
    @keyframes pulse{
      0%{transform:scale(1)}
      25%{transform:scale(1.4)}
      50%{transform:scale(1.2)}
      100%{transform:scale(1)}
    }
    .pulse{animation:pulse .35s ease}

    /* ===== MODAL ===== */
    .modal-overlay{ 
      position:fixed; 
      inset:0; 
      background:rgba(0,0,0,0.6); 
      backdrop-filter: blur(4px);
      display:none; 
      align-items:center; 
      justify-content:center; 
      z-index:2000;
      animation: fadeIn 0.2s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal{
      width:min(1100px, 94vw);
      max-height:92vh; 
      overflow:auto;
      background:#fff; 
      border-radius:20px; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      display:grid; 
      grid-template-columns: 1.4fr 1fr; 
      gap:0; 
      position:relative;
      animation: modalSlide 0.3s ease;
    }
    @keyframes modalSlide {
      from { opacity: 0; transform: scale(0.95) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal .modal-img{ 
      background:#f8f8f8; 
      min-height:400px;
      position: relative;
      overflow: hidden;
    }
    .modal .modal-img img{ 
      width:100%; 
      height:100%; 
      object-fit:cover; 
      border-top-left-radius:20px; 
      border-bottom-left-radius:20px;
    }

    .modal .modal-body{ 
      padding:32px 28px 28px; 
      position:relative;
      overflow-y: auto;
    }
    .modal h2{ 
      margin-bottom:12px; 
      padding-right:48px;
      font-size: 1.6rem;
      line-height: 1.3;
      color: var(--ink);
    }
    .modal .price-lg{
      font-size:1.5rem; 
      font-weight:800; 
      color:var(--brand-accent); 
      margin-bottom:16px;
    }

    .meta{
      display:grid; 
      grid-template-columns:1fr 1fr; 
      gap:12px; 
      margin:16px 0 20px;
    }
    .meta div{
      background:#fafafa; 
      border:1px solid #eee; 
      border-radius:10px; 
      padding:14px; 
      font-size:0.9rem;
      line-height: 1.4;
    }
    .meta div strong{
      display: block;
      color: var(--muted);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .desc{
      color:#555; 
      line-height:1.7; 
      margin:10px 0 20px;
      font-size: 0.95rem;
    }

    .btn-primary{ 
      background:var(--brand-accent); 
      color:#fff; 
      border:none; 
      border-radius:10px; 
      padding:12px 24px; 
      font-weight:700;
      font-size: 1rem;
      cursor:pointer;
      text-decoration: none;
      display: inline-block;
      transition: var(--transition);
      box-shadow: 0 4px 12px rgba(244, 162, 123, 0.3);
    }
    .btn-primary:hover{
      background: #e18f6a;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(244, 162, 123, 0.4);
    }

    .close-x{
      position:absolute; 
      top:16px; 
      right:16px;
      background:rgba(255,255,255,0.95); 
      color:#000;
      border:none;
      border-radius:50%; 
      width: 36px;
      height: 36px;
      cursor:pointer; 
      font-weight:800;
      font-size: 1.2rem;
      z-index:10;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .close-x:hover{
      background: #fff;
      transform: rotate(90deg) scale(1.1);
    }

    .modal-heart{
      position:absolute; 
      bottom:24px; 
      right:24px; 
      font-size:28px; 
      background:none; 
      border:none; 
      color:#ddd; 
      cursor:pointer;
      transition: var(--transition);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-heart:hover{
      transform: scale(1.2);
      background: rgba(0,0,0,0.05);
    }
    .modal-heart.liked{
      color:#e63946;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width:1024px){
      .filters{
        grid-template-columns:repeat(3, 1fr);
      }
    }

    @media (max-width:768px){
      header{
        position:static; 
        backdrop-filter:none; 
        -webkit-backdrop-filter:none; 
        background:var(--card);
      }
        /* ‚úÖ Add this block at the end of the same @media */
  .product img {
    width: 100%;
    height: auto;
    aspect-ratio: 4 / 3;   /* keeps consistent tile proportion */
    object-fit: cover;     /* same visual crop as desktop */
    background: #fff;
    display: block;
  }
}
      .top-bar{
        padding: 12px 16px;
      }
      
      .logo img{ height: 50px; }
      
      .styles{
        padding:12px 16px;
        mask-image: linear-gradient(to right, black 85%, transparent 100%);
      }
      
      .style-card{
        min-width: 120px;
        height: 100px;
      }
      
      .filters{
        display:none; 
        grid-template-columns:1fr;
        padding: 16px;
      }
      .filters.active{display:grid}
      
      #filterToggle{display:block}
      
      #product-count{
        margin: 16px 16px 12px;
        padding: 0 16px;
      }
      
      #product-list{
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 20px;
        padding: 0 16px 30px;
      }
      
      .product img{
        height: 240px;
      }
      
      .modal{
        grid-template-columns:1fr;
        width: 96vw;
        max-height: 94vh;
      }
      .modal .modal-img img{
        border-radius:20px 20px 0 0;
        max-height: 350px;
      }
      .modal .modal-body{
        padding: 24px 20px 70px;
      }
      .meta{
        grid-template-columns: 1fr;
      }
    }

    @media (max-width:480px){
      #product-list{
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-bar">
      <div class="logo"><img src="Home-in-on-logo.webp" alt="HomeInOn Logo"></div>
      <button id="toggleFavourites">‚≠ê View Favourites</button>
    </div>

    <div class="styles" id="styleSelector"></div>

    <button id="filterToggle">Show Filters ‚¨áÔ∏è</button>

    <section class="filters" id="filters">
      <div class="filter-group">
        <label for="searchBox">Search</label>
        <input type="text" id="searchBox" placeholder="e.g. oak table, mirror, sofa‚Ä¶"/>
      </div>

      <div class="filter-group">
        <label for="category">Category</label>
        <select id="category"><option value="">All</option></select>
      </div>

      <div class="filter-group">
        <label for="material">Material</label>
        <select id="material"><option value="">All</option></select>
      </div>

      <div class="filter-group colour-dropdown">
        <label for="colourSelect">Colour</label>
        <div id="colourSelect" class="colour-select">All</div>
        <div id="colourList" class="colour-list"></div>
      </div>

      <div class="filter-group">
        <label for="priceRange">Max Price (¬£)</label>
        <input type="range" id="priceRange" min="0" max="2000" step="10" value="2000"/>
        <span id="priceValue">¬£2000</span>
      </div>

      <!-- Clear filters -->
      <div class="filter-group">
        <label>&nbsp;</label>
        <button id="clearFilters" class="btn-outline">Clear filters</button>
      </div>
    </section>
  </header>

  <p id="product-count"></p>
  <div id="product-list"></div>

  <div id="productModal" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close-x" id="modalClose" aria-label="Close">‚úï</button>
      <div class="modal-img"><img id="modalImage" alt="Product image"/></div>
      <div class="modal-body">
        <h2 id="modalTitle">Title</h2>
        <div class="price-lg" id="modalPrice">¬£0.00</div>
        <div class="meta">
          <div><strong>Category:</strong> <span id="modalCategory">‚Äî</span></div>
          <div><strong>Material:</strong> <span id="modalMaterial">‚Äî</span></div>
          <div><strong>Colour:</strong> <span id="modalColour">‚Äî</span></div>
          <div><strong>Style:</strong> <span id="modalStyle">‚Äî</span></div>
        </div>
        <div class="desc" id="modalDescription">Description here‚Ä¶</div>
        <a id="modalLink" class="btn-primary" href="#" target="_blank" rel="noopener" style="display:none">View product</a>
        <!-- modal heart -->
        <button id="modalHeart" class="modal-heart" title="Favourite">‚ù§</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "https://homeinon-backend.onrender.com/products";

    const STYLE_IMAGES = {
      "modern":"style-modern.jpg",
      "boho":"style-boho.jpg",
      "scandi":"style-scandi.jpg",
      "industrial":"style-industrial.jpg",
      "farmhouse":"https://placehold.co/200x150?text=Farmhouse",
      "mid-century":"https://placehold.co/200x150?text=Mid-century",
      "art deco":"https://placehold.co/200x150?text=Art+Deco",
      "coastal":"https://placehold.co/200x150?text=Coastal"
    };

    const colourMap = {
      white:"#ffffff", black:"#000000", grey:"#9e9e9e", gray:"#9e9e9e",
      oak:"#c49a6c", walnut:"#7a5734", pine:"#d5b887", beige:"#d9c7a2",
      gold:"#c8a951", silver:"#bdbdbd", blue:"#5a7abf", green:"#6aa67a",
      red:"#c74c4c", brown:"#8b5a2b", cream:"#f3e9d2", yellow:"#f8e473",
      ivory:"#fffff0", natural:"#d6b98c", charcoal:"#36454f", teal:"#367588",
      taupe:"#b38b6d", stone:"#c2b59b", pink:"#f7c6d9", orange:"#f6a04d",
      navy:"#001f3f", mink:"#b7a295", copper:"#b87333", bronze:"#cd7f32",
      lilac:"#c8a2c8", sage:"#a9bfa5", mustard:"#e1ad01", terracotta:"#e2725b",
      pewter:"#8e9292"
    };
    const colourHex = n => colourMap[String(n||"").toLowerCase()] || "#ccc";

    function deriveStyle(txt=""){
      const t = String(txt).toLowerCase();
      if(t.includes("boho")) return "Boho";
      if(t.includes("industrial")||t.includes("metal")) return "Industrial";
      if(t.includes("scandi")||t.includes("nordic")) return "Scandi";
      if(t.includes("farmhouse")||t.includes("rustic")) return "Farmhouse";
      if(t.includes("mid")||t.includes("retro")) return "Mid-century";
      if(t.includes("art deco")||t.includes("glam")) return "Art Deco";
      if(t.includes("coastal")||t.includes("beach")) return "Coastal";
      return "Modern";
    }

    let allProducts = [];
    let selectedStyle = "";
    let selectedColour = "";
    let showFavourites = false;
    let favourites = JSON.parse(localStorage.getItem("favourites")||"[]");

    // --- state helpers
    function getState(){
      return {
        q: document.getElementById("searchBox").value.toLowerCase(),
        category: document.getElementById("category").value,
        material: document.getElementById("material").value,
        colour: selectedColour,
        style: selectedStyle,
        max: parseFloat(document.getElementById("priceRange").value) || Infinity
      };
    }
    function filterProducts(state, ignoreField){
      return allProducts.filter(p=>{
        const t = (p.title||"").toLowerCase();
        const d = (p.description||"").toLowerCase();
        const price = parseFloat(p.price)||0;

        const checks = {
          q: (!state.q) || t.includes(state.q) || d.includes(state.q),
          category: (!state.category) || p.category === state.category,
          material: (!state.material) || p.material === state.material,
          colour: (!state.colour) || (p.colour && p.colour.toLowerCase().includes(state.colour.toLowerCase())),
          style: (!state.style) || p.style === state.style,
          max: price <= state.max
        };
        if(ignoreField){ checks[ignoreField] = true; }
        if(showFavourites){
          checks.fav = favourites.includes(p.title || p.sku || "");
        }
        return Object.values(checks).every(Boolean);
      });
    }
    const uniqueValues = (arr, field)=>{
      const s = new Set();
      arr.forEach(p=>{
        const v = p[field]; if(!v) return;
        String(v).split(/[,/|;]/).forEach(x=>{
          const val = x.trim(); if(val) s.add(val);
        });
      });
      return [...s];
    };

    // --- UI builders
    function buildStyleCards(styles){
      const row = document.getElementById("styleSelector");
      row.innerHTML = "";
      styles.forEach(style=>{
        const card = document.createElement("div");
        card.className = "style-card";
        const imgSrc = STYLE_IMAGES[style.toLowerCase()] || `https://placehold.co/200x150?text=${encodeURIComponent(style)}`;
        card.innerHTML = `<img src="${imgSrc}" alt="${style}"><span>${style}</span>`;
        card.addEventListener("click", ()=>{
          document.querySelectorAll(".style-card").forEach(c=>c.classList.remove("active"));
          if(selectedStyle === style){ selectedStyle = ""; }
          else { selectedStyle = style; card.classList.add("active"); }
          updateFilterOptions();
          applyFilters();
        });
        row.appendChild(card);
      });
    }
    function buildColourDropdown(colours, keepSelection=true){
      const select = document.getElementById("colourSelect");
      const list = document.getElementById("colourList");
      const prev = keepSelection ? selectedColour : "";

      list.innerHTML = "";
      const allItem = document.createElement("div");
      allItem.className = "colour-item";
      allItem.textContent = "All";
      allItem.addEventListener("click", ()=>{
        selectedColour = ""; select.textContent = "All"; list.classList.remove("active"); applyFilters();
      });
      list.appendChild(allItem);

      colours.forEach(c=>{
        const item = document.createElement("div");
        item.className = "colour-item";
        item.innerHTML = `<span class="swatch" style="background:${colourHex(c)}"></span>${c}`;
        item.addEventListener("click", ()=>{
          selectedColour = c;
          select.innerHTML = `<span class="swatch" style="background:${colourHex(c)}"></span>${c}`;
          list.classList.remove("active");
          updateFilterOptions();
          applyFilters();
        });
        list.appendChild(item);
      });

      if(prev){
        selectedColour = colours.includes(prev) ? prev : "";
        if(selectedColour){
          select.innerHTML = `<span class="swatch" style="background:${colourHex(selectedColour)}"></span>${selectedColour}`;
        }else{
          select.textContent = "All";
        }
      }else{
        select.textContent = "All";
      }

      select.onclick = ()=> list.classList.toggle("active");
      document.addEventListener("click", e=>{
        if(!e.target.closest(".colour-dropdown")) list.classList.remove("active");
      });
    }

    function renderProducts(products){
      const list = document.getElementById("product-list");
      const count = document.getElementById("product-count");
      list.innerHTML = "";
      count.textContent = `${products.length} product${products.length!==1?"s":""} found`;

      // Empty state
      if(products.length === 0){
        list.innerHTML = `
          <div style="grid-column: 1/-1; text-align:center; padding:80px 20px">
            <div style="font-size:4rem; margin-bottom:16px">${showFavourites ? 'üíî' : 'üîç'}</div>
            <h3 style="color:var(--ink); margin-bottom:8px">
              ${showFavourites ? 'No favourites yet' : 'No products found'}
            </h3>
            <p style="color:var(--muted)">
              ${showFavourites ? 'Click the ‚ù§Ô∏è on products you love!' : 'Try adjusting your filters'}
            </p>
          </div>
        `;
        return;
      }

      products.forEach((p, idx)=>{
        const price = parseFloat(p.price) || 0;
        const liked = favourites.includes(p.title || p.sku || "");
        const div = document.createElement("div");
        div.className = "product";
        div.setAttribute("data-index", idx);
        div.innerHTML = `
          <div class="style-label">${p.style || ""}</div>
          <img src="${p.image_url}" alt="${p.title}" onerror="this.src='https://placehold.co/340x240?text=No+Image'"/>
          <div class="product-info">
            <h3>${p.title}</h3>
            <p class="price">¬£${price.toFixed(2)}</p>
          </div>
          <button class="heart-btn ${liked ? "liked":""}" title="Favourite" data-key="${p.title || p.sku || ""}">‚ù§</button>
        `;
        div.addEventListener("click", (e)=>{ if(!e.target.classList.contains("heart-btn")) openProductModal(idx); });
        div.querySelector(".heart-btn").addEventListener("click", (e)=>{
          e.stopPropagation();
          toggleFavourite(e.currentTarget.dataset.key, e.currentTarget);
        });

        list.appendChild(div);
      });
    }

    function applyFilters(){
      const filtered = filterProducts(getState());
      renderProducts(filtered);
    }

    function updateFilterOptions(){
      const state = getState();

      const catList = uniqueValues(filterProducts(state, 'category'), 'category').sort();
      const catSel = document.getElementById("category");
      const currentCat = state.category;
      catSel.innerHTML = '<option value="">All</option>' + catList.map(c=>`<option value="${c}">${c}</option>`).join("");
      if(currentCat && catList.includes(currentCat)) catSel.value = currentCat; else catSel.value = "";

      const matList = uniqueValues(filterProducts(state, 'material'), 'material').sort();
      const matSel = document.getElementById("material");
      const currentMat = state.material;
      matSel.innerHTML = '<option value="">All</option>' + matList.map(m=>`<option value="${m}">${m}</option>`).join("");
      if(currentMat && matList.includes(currentMat)) matSel.value = currentMat; else matSel.value = "";

      const colourList = uniqueValues(filterProducts(state, 'colour'), 'colour').sort();
      buildColourDropdown(colourList, true);
    }

    function toggleFavourite(key, btnEl){
      if(!key) return;
      const i = favourites.indexOf(key);
      if(i>=0){ favourites.splice(i,1); btnEl.classList.remove("liked"); }
      else{ favourites.push(key); btnEl.classList.add("liked","pulse"); setTimeout(()=>btnEl.classList.remove("pulse"),300); }
      localStorage.setItem("favourites", JSON.stringify(favourites));
    }

    // modal
    const modalOverlay = document.getElementById("productModal");
    const modalImage   = document.getElementById("modalImage");
    const modalTitle   = document.getElementById("modalTitle");
    const modalPrice   = document.getElementById("modalPrice");
    const modalCat     = document.getElementById("modalCategory");
    const modalMat     = document.getElementById("modalMaterial");
    const modalCol     = document.getElementById("modalColour");
    const modalStyle   = document.getElementById("modalStyle");
    const modalDesc    = document.getElementById("modalDescription");
    const modalLink    = document.getElementById("modalLink");
    const modalClose   = document.getElementById("modalClose");
    const modalHeart   = document.getElementById("modalHeart");
    let modalKey = "";

    function openProductModal(index){
      const filtered = filterProducts(getState());
      const p = filtered[index];
      if(!p) return;

      modalImage.src = p.image_url || "https://placehold.co/640x480?text=No+Image";
      modalImage.onerror = () => modalImage.src = "https://placehold.co/640x480?text=No+Image";
      modalTitle.textContent = p.title || "Untitled";
      modalPrice.textContent = `¬£${(parseFloat(p.price)||0).toFixed(2)}`;
      modalCat.textContent = p.category || "‚Äî";
      modalMat.textContent = p.material || "‚Äî";
      modalCol.textContent = p.colour || "‚Äî";
      modalStyle.textContent = p.style || deriveStyle(p.title || p.description);
      modalDesc.textContent = p.description || "‚Äî";
      modalKey = p.title || p.sku || "";

      if(p.url){ modalLink.style.display="inline-block"; modalLink.href=p.url; }
      else { modalLink.style.display="none"; modalLink.removeAttribute("href"); }

      if(favourites.includes(modalKey)) modalHeart.classList.add("liked"); else modalHeart.classList.remove("liked");

      modalOverlay.style.display = "flex";
      modalOverlay.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeProductModal(){
      modalOverlay.style.display = "none";
      modalOverlay.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }
    modalClose.addEventListener("click", closeProductModal);
    modalOverlay.addEventListener("click", (e)=>{ if(e.target === modalOverlay) closeProductModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeProductModal(); });
    modalHeart.addEventListener("click", ()=>{
      toggleFavourite(modalKey, modalHeart);
      applyFilters();
    });

    // load & boot
    async function loadProducts(){
      const res = await fetch(API_URL);
      const data = await res.json();
      allProducts = (data.products || []).map(p=>({
        ...p,
        style: p.style || deriveStyle(p.title || p.description)
      }));

      const styles = uniqueValues(allProducts, "style").sort();
      const cats   = uniqueValues(allProducts, "category").sort();
      const mats   = uniqueValues(allProducts, "material").sort();
      const cols   = uniqueValues(allProducts, "colour").sort();

      buildStyleCards(styles);

      const catSel = document.getElementById("category");
      const matSel = document.getElementById("material");
      catSel.innerHTML = '<option value="">All</option>' + cats.map(c=>`<option value="${c}">${c}</option>`).join("");
      matSel.innerHTML = '<option value="">All</option>' + mats.map(m=>`<option value="${m}">${m}</option>`).join("");

      buildColourDropdown(cols, true);

      const maxP = Math.ceil(Math.max(0, ...allProducts.map(p=>parseFloat(p.price)||0))/50)*50 || 2000;
      const pr = document.getElementById("priceRange");
      pr.max = maxP; pr.value = maxP;
      document.getElementById("priceValue").textContent = `¬£${maxP}`;

      renderProducts(allProducts);
    }

    document.getElementById("toggleFavourites").addEventListener("click", ()=>{
      showFavourites = !showFavourites;
      document.getElementById("toggleFavourites").textContent = showFavourites ? "üîô View All Products" : "‚≠ê View Favourites";
      applyFilters();
    });

    document.getElementById("clearFilters").addEventListener("click", ()=>{
      document.getElementById("searchBox").value = "";
      document.getElementById("category").value = "";
      document.getElementById("material").value = "";
      selectedColour = "";
      document.getElementById("colourSelect").textContent = "All";
      selectedStyle = "";
      document.querySelectorAll(".style-card").forEach(c=>c.classList.remove("active"));

      const max = document.getElementById("priceRange").max || 2000;
      document.getElementById("priceRange").value = max;
      document.getElementById("priceValue").textContent = `¬£${max}`;

      updateFilterOptions();
      applyFilters();
    });

    document.getElementById("filterToggle").addEventListener("click", ()=>{
      const f = document.getElementById("filters");
      f.classList.toggle("active");
      document.getElementById("filterToggle").textContent = f.classList.contains("active") ? "Hide Filters ‚ñ≤" : "Show Filters ‚¨áÔ∏è";
    });

    document.getElementById("searchBox").addEventListener("input", ()=>{ updateFilterOptions(); applyFilters(); });
    document.getElementById("category").addEventListener("change", ()=>{ updateFilterOptions(); applyFilters(); });
    document.getElementById("material").addEventListener("change", ()=>{ updateFilterOptions(); applyFilters(); });
    document.getElementById("priceRange").addEventListener("input", e=>{
      document.getElementById("priceValue").textContent = `¬£${e.target.value}`;
      updateFilterOptions(); applyFilters();
    });

    loadProducts();
  </script>
</body>
</html>
